<!-- templates/main/home.html -->
{% extends 'main/base.html' %}

{% block content %}
<div class="container mx-auto p-4">
    <!-- 상단 네비게이션 -->
    <div class="flex justify-between items-center mb-8 border-b pb-4">
        <div class="flex space-x-4">
            <a href="#" class="text-gray-700">오늘의 할일</a>
            <a href="#" class="text-gray-700">출석체크</a>
        </div>
        <div class="flex items-center">
            <div class="bg-white rounded-full px-8 py-2 border">SPAM CHECK</div>
            {% if user.is_authenticated %}
            <span class="ml-4 text-gray-700 font-semibold">안녕하세요, {{ user.username }}님</span>
            <a href="{% url 'logout' %}" class="ml-4 bg-red-500 text-white px-4 py-2 rounded">로그아웃</a>
            {% else %}
            <a href="{% url 'login' %}" class="ml-8 bg-purple-500 text-white px-4 py-2 rounded">로그인 / 회원가입</a>
            {% endif %}
        </div>
    </div>

    <!-- 오늘의 할일 섹션 -->
    <div class="mb-12">
        <h2 class="text-xl font-semibold mb-4">
            오늘의 할일 : <span id="task-count">0</span>
        </h2>
        <div id="today-tasks" class="grid grid-cols-4 gap-4">
            <!-- 기본 카드 -->
            <div class="border rounded-lg p-4 relative">
                <button id="add-task-btn" class="absolute top-2 right-2 text-gray-400">+</button>
                <p class="text-gray-500 mt-8 text-center">
                    오늘의 할일이<br />
                    존재하지 않습니다
                </p>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const taskContainer = document.getElementById("today-tasks");
    const taskCountDisplay = document.getElementById("task-count");
    let taskCount = 0; // 추가된 할일 수
    let completedCount = 0; // 완료된 할일 수

    // + 버튼 클릭 이벤트
    document.getElementById("add-task-btn").addEventListener("click", function () {
        // 기본 카드 제거 (없으면 무시)
        const defaultCard = taskContainer.querySelector("div:first-child p");
        if (defaultCard) defaultCard.parentElement.remove();

        // 새로운 할일 카드 추가
        const newTask = document.createElement("div");
        newTask.className = "border rounded-lg p-4 relative";
        newTask.innerHTML = `
            <div class="flex justify-between items-start">
                <span class="font-medium">새로운 할일</span>
                <button class="text-gray-400">+</button>
            </div>
            <div class="mt-4 space-y-2">
                <label class="flex items-start space-x-2">
                    <input type="checkbox" class="mt-1 task-checkbox">
                    <input type="text" class="border rounded w-full px-2 py-1" placeholder="내용을 입력하세요">
                </label>
            </div>
        `;
        taskContainer.appendChild(newTask);

        // 할일 카운트 증가
        taskCount++;
        updateTaskCount();
    });

    // 할일 체크박스 상태 업데이트 이벤트
    taskContainer.addEventListener("change", function (event) {
        if (event.target.classList.contains("task-checkbox")) {
            if (event.target.checked) {
                completedCount++;
            } else {
                completedCount--;
            }
            updateTaskCount();
        }
    });

    // 할일 카운트 업데이트 함수
    function updateTaskCount() {
        taskCountDisplay.textContent = taskCount - completedCount;
    }
});
</script>
{% endblock %}
